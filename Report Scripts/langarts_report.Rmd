---
title: "langarts_report"
author: "Kevin Gilds, MPA"
date: "April 9, 2017"
output: github_document
---


```{r reading_import_libaries, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(pander)
library(ggplot2)
library(sqldf)
library(knitr)
library(reshape2)
library(getREAL)

```


```{r}
setwd("C:/Users/kevin/Dropbox/GetReal/Data/sqlite")

### Make connection with database
getRealdb<- dbConnect(SQLite(), dbname="outcome_history.sqlite")

q1_langarts <- dbReadTable(getRealdb,"Q1_langarts_1617")

q2_langarts <- dbReadTable(getRealdb, "Q2_langarts_1617")

q3_langarts <- dbReadTable(getRealdb, "Q3_langarts_1617")

dim(q1_langarts)

dim(q2_langarts)

```



```{r}

#students <- with(q1_reading, tapply(girl_code, reading_pts, mean))

q1_lang_avg <- aggregate(lang_pts ~ girl_code + council, data = q1_langarts, mean)

q1_lang_avg_s <- q1_lang_avg %>%
    mutate("Time" = "Q1")

q2_lang_avg <- aggregate(lang_pts ~ girl_code + council, data = q2_langarts, mean)

q2_lang_avg_s <- q2_lang_avg %>%
    mutate("Time" = "Q2")

q3_lang_avg <-aggregate(lang_pts ~ girl_code + council, data= q3_langarts, mean)

q3_lang_avg_s <- q3_lang_avg %>%
    mutate("Time" = "Q3")

```



```{r}
q1q3 <- inner_join(q1_lang_avg_s,q3_lang_avg_s, by="girl_code") %>%
    rename(council = council.x) %>%
    rename(baseline = lang_pts.x) %>%
    rename(data_source_1 = Time.x) %>%
    rename(final = lang_pts.y) %>%
    rename(data_source_2 = Time.y)%>%
    select(1:4,6:7)

head(q1q3)

dim(q1q3)
```


```{r}
no_q1q3 <- anti_join(q1_lang_avg_s, q3_lang_avg_s, by="girl_code")

head(no_q1q3)

dim(no_q1q3)

```

```{r}
q1q2 <- inner_join(no_q1q3, q2_lang_avg_s, by="girl_code") %>%
    rename(council = council.x) %>%
    rename(baseline = lang_pts.x) %>%
    rename(data_source_1 = Time.x) %>%
    rename(final = lang_pts.y) %>%
    rename(data_source_2 = Time.y)%>%
    select(1:4,6:7)



```


```{r}
no_matches <- anti_join(no_q1q3, q2_lang_avg_s, by="girl_code")

dim(no_matches)

head(no_matches)
```

```{r}
q1_run <- rbind(q1q3, q1q2)

dim(q1_run)

head(q1_run)

```


```{r}
q2q3 <- inner_join(q2_lang_avg_s, q3_lang_avg_s, by="girl_code")

q2_run <- anti_join(q2q3, q1_run, by="girl_code")%>%
    rename(council = council.x) %>%
    rename(baseline = lang_pts.x) %>%
    rename(data_source_1 = Time.x) %>%
    rename(final = lang_pts.y) %>%
    rename(data_source_2 = Time.y)%>%
    select(1:4,6:7)


dim(q2_run)

q1_q2_run <- rbind(q1_run, q2_run)

dim(q1_q2_run)




```


```{r}
kable(q1_q2_run)
```


```{r}
q1_q2_run_t <- q1_q2_run %>%
    summarise(n_distinct(girl_code))

q1_q2_run_t
```


```{r}
q3_test <- rbind(q1_lang_avg_s, q2_lang_avg_s)

q3_test <- rbind(q3_test,q3_lang_avg_s)


head(q3_test)
```











```{r eval=FALSE}

lang_arts_comparisons <- inner_join(q2_lang_avg, q1_lang_avg, by="girl_code")




```



```{r eval=FALSE}
lang_arts_comparisons <- lang_arts_comparisons %>%
    rename(Q2_Avg = lang_pts.x)%>%
    rename(Q1_Avg = lang_pts.y)%>%
    rename(council = council.x)%>%
    mutate(diff = Q2_Avg - Q1_Avg)%>%
    mutate("Data_Source" = "Q2-Q1")

dim(lang_arts_comparisons)

head(lang_arts_comparisons)

```

